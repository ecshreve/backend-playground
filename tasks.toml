###
# go tasks
###
[[task]]
  id = "build:gql"
  type = "short"
  dependencies = ["gqlgen"]
  cmd = """
  echo "Building gqlserver..."
  go build -o bin/gqlserver ./cmd/gqlserver
  """

[[task]]
  id = "build:grpc"
  type = "short"
  dependencies = ["protogen"]
  cmd = """
  echo "Building grpcserver..."
  go build -o bin/grpcserver ./cmd/grpcserver
  """

[[task]]
    id = "test"
    type = "short"
    cmd = "go test ./..."

###
# code generation tasks
###
[[task]]
  id = "entgen"
  description = "Generate ent schema"
  type = "short"
  watch = ["ent/schema/*.go", "ent/entc.go"]
  cmd = """
    echo "Running ent generation with entc..."
    go run -mod=mod ent/entc.go
  """

[[task]]
  id = "gqlgen"
  description = "Generate graphql"
  type = "short"
  dependencies = ["entgen"]
  cmd = """
    echo "Running gqlgen generation with gqlgen..."
    go run -mod=mod github.com/99designs/gqlgen
  """

[[task]]
  id = "protogen"
  description = "Generate protos"
  type = "short"
  dependencies = ["entgen"]
  cmd = """
    echo "Running proto generation..."
    go generate ./ent/proto/...
  """

###
# server tasks
###
[[task]]
  id = "gqlserver"
  description = "Run graphql server"
  type = "long"
  triggers = ["build:gql"]
  dependencies = ["build:gql"]
  cmd = """
  echo "Running gqlserver..."
  ./bin/gqlserver
  """

[[task]]
  id = "grpcserver"
  description = "Run grpcserver server"
  type = "long"
  triggers = ["build:grpc"]
  dependencies = ["build:grpc"]
  cmd = """
  echo "Running grpcserver server..."
  ./bin/grpcserver
  """

[[task]]
  id = "grpcclient"
  description = "Run grpcclient"
  type = "short"
  cmd = "go run ./cmd/grpcclient/main.go"


###
# dev server
###
[[task]]
  id = "dev"
  type = "long"
  dependencies = ["grpcserver", "gqlserver"]
  cmd = """
  echo 'Running dev server...'
  while true; do sleep 1; done
  """